<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RAG Architecture for Business Knowledge: Build AI That Knows Your Company | B2B Vic</title>
    <meta name="description" content="Implement retrieval-augmented generation (RAG) to give AI access to internal docs, SOPs, and proprietary knowledge. Answer questions instantly." />
    <meta name="author" content="Victor Valentine Romo" />
    <meta property="og:title" content="RAG Architecture for Business Knowledge: Build AI That Knows Your Company" />
    <meta property="og:description" content="Implement retrieval-augmented generation (RAG) to give AI access to internal docs, SOPs, and proprietary knowledge. Answer questions instantly." />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://b2bvic.com/articles/rag-architecture-business-knowledge.html" />
    <meta property="og:site_name" content="B2B Vic" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="RAG Architecture for Business Knowledge: Build AI That Knows Your Company" />
    <meta name="twitter:description" content="Implement retrieval-augmented generation (RAG) to give AI access to internal docs, SOPs, and proprietary knowledge. Answer questions instantly." />
    <link rel="canonical" href="https://b2bvic.com/articles/rag-architecture-business-knowledge.html" />

    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230a0a0a' width='100' height='100' rx='12'/><text x='50' y='70' font-family='sans-serif' font-size='38' font-weight='700' fill='%23d97706' text-anchor='middle'>VVR</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700&family=DM+Sans:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              base: '#0a0a0a',
              surface: { DEFAULT: '#171717', overlay: '#262626' },
              accent: { DEFAULT: '#d97706', light: '#f59e0b' },
              zinc: {
                50: '#fafafa', 100: '#f4f4f5', 200: '#e4e4e7', 300: '#d4d4d8',
                400: '#a1a1aa', 500: '#71717a', 600: '#52525b', 700: '#3f3f46',
                800: '#27272a', 900: '#18181b', 950: '#09090b'
              }
            },
            fontFamily: {
              display: ['Sora', 'system-ui', '-apple-system', 'sans-serif'],
              body: ['Sora', 'system-ui', '-apple-system', 'sans-serif'],
              mono: ['IBM Plex Mono', 'ui-monospace', 'monospace']
            }
          }
        }
      }
    </script>
    <link rel="me" href="https://scalewithsearch.com" />
    <link rel="me" href="https://victorvalentineromo.com" />
    <link rel="me" href="https://aifirstsearch.com" />
    <link rel="me" href="https://browserprompt.com" />
    <link rel="me" href="https://creatinepedia.com" />
    <link rel="me" href="https://polytraffic.com" />
    <link rel="me" href="https://tattooremovalnear.com" />
    <link rel="me" href="https://comicstripai.com" />
    <link rel="me" href="https://b2bvic.com" />
    <link rel="me" href="https://aipaypercrawl.com" />
    <link rel="me" href="https://seobyrole.com" />
    <link rel="me" href="https://quickfixseo.com" />
    <style>

    /* Mega menu */
    .mega-panel { transition: opacity 0.15s ease, visibility 0.15s ease; }
    .mega-panel.hidden { opacity: 0; visibility: hidden; display: none; }
    .mega-panel:not(.hidden) { opacity: 1; visibility: visible; display: block; }
    .mega-link {
      display: block; padding: 6px 0;
      font-size: 0.875rem; color: #a1a1aa;
      transition: color 0.15s;
    }
    .mega-link:hover { color: #fafafa; text-decoration: none; }
    .mega-view-all {
      display: inline-block; margin-top: 12px;
      font-size: 0.8125rem; font-weight: 500;
      color: #d97706; transition: color 0.15s;
    }
    .mega-view-all:hover { color: #f59e0b; text-decoration: none; }

    /* Nav effects */
    .nav-link { position: relative; }
    .nav-link::after {
      content: ''; position: absolute; bottom: -2px; left: 0;
      width: 0; height: 1px; background: #d97706; transition: width 0.3s ease;
    }
    .nav-link:hover::after { width: 100%; }
    .cta-glow { position: relative; }
    .cta-glow::before {
      content: ''; position: absolute; inset: -2px;
      background: linear-gradient(135deg, #f59e0b, #d97706);
      border-radius: inherit; opacity: 0; filter: blur(12px);
      transition: opacity 0.3s ease; z-index: -1;
    }
    .cta-glow:hover::before { opacity: 0.5; }

    /* Active trigger state */
    .mega-trigger[aria-expanded="true"] { color: #fafafa; }
    .mega-trigger[aria-expanded="true"] svg { transform: rotate(180deg); }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #0a0a0a; }
    ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #3f3f46; }

    /* Article prose overrides for dark theme */
    .prose-dark h1, .prose-dark h2, .prose-dark h3, .prose-dark h4 { color: #fafafa; }
    .prose-dark p, .prose-dark li, .prose-dark td, .prose-dark th { color: #a1a1aa; }
    .prose-dark strong { color: #fafafa; }
    .prose-dark a { color: #d97706; }
    .prose-dark a:hover { color: #f59e0b; }
    .prose-dark blockquote { border-left-color: #d97706; background: #171717; padding: 1rem 1.5rem; border-radius: 0 0.5rem 0.5rem 0; }
    .prose-dark blockquote p { color: #a1a1aa; }
    .prose-dark code { background: #171717; color: #f59e0b; padding: 0.15em 0.4em; border-radius: 0.25rem; font-size: 0.875em; }
    .prose-dark pre { background: #171717; border: 1px solid #27272a; border-radius: 0.5rem; }
    .prose-dark pre code { background: transparent; color: #a1a1aa; padding: 0; }
    .prose-dark hr { border-color: #27272a; }
    .prose-dark ul { list-style-type: disc; }
    .prose-dark ol { list-style-type: decimal; }
    .prose-dark table { border-collapse: collapse; }
    .prose-dark th { border-bottom: 2px solid #27272a; padding: 0.75rem; text-align: left; }
    .prose-dark td { border-bottom: 1px solid #27272a; padding: 0.75rem; }
    .prose-dark img { border-radius: 0.5rem; }

    </style>
    <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@graph": [
    {
      "@type": "Article",
      "headline": "RAG Architecture for Business Knowledge: Build AI That Knows Your Company",
      "description": "Implement retrieval-augmented generation (RAG) to give AI access to internal docs, SOPs, and proprietary knowledge. Answer questions instantly.",
      "author": {
        "@type": "Person",
        "name": "Victor Valentine Romo",
        "url": "https://victorvalentineromo.com",
        "jobTitle": "Fractional SEO Consultant",
        "sameAs": [
          "https://scalewithsearch.com",
          "https://victorvalentineromo.com",
          "https://aifirstsearch.com",
          "https://browserprompt.com",
          "https://creatinepedia.com",
          "https://polytraffic.com",
          "https://tattooremovalnear.com",
          "https://comicstripai.com",
          "https://b2bvic.com",
          "https://aipaypercrawl.com",
          "https://seobyrole.com",
          "https://quickfixseo.com"
        ]
      },
      "publisher": {
        "@type": "Organization",
        "name": "B2B Vic",
        "url": "https://b2bvic.com"
      },
      "datePublished": "2026-02-08",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://b2bvic.com/articles/rag-architecture-business-knowledge.html"
      }
    },
    {
      "@type": "BreadcrumbList",
      "itemListElement": [
        {
          "@type": "ListItem",
          "position": 1,
          "name": "Home",
          "item": "https://b2bvic.com/"
        },
        {
          "@type": "ListItem",
          "position": 2,
          "name": "Writing",
          "item": "https://b2bvic.com/articles.html"
        },
        {
          "@type": "ListItem",
          "position": 3,
          "name": "RAG Architecture for Business Knowledge: Build AI That Knows Your Company"
        }
      ]
    }
  ]
}
    </script>
</head>
<body class="bg-[#0a0a0a] text-zinc-400 antialiased font-body">


  <nav class="fixed top-0 left-0 right-0 z-50 border-b border-zinc-800/60 bg-[#0a0a0a]/95 backdrop-blur-md">
    <div class="max-w-6xl mx-auto">
      <div class="flex items-center justify-between h-16 px-6">
        <!-- Logo -->
        <a href="/" class="flex items-center gap-2 group">
          <span class="font-display font-700 text-xl tracking-tight text-amber-500 group-hover:text-amber-400 transition-colors">b2bvic</span>
        </a>

        <!-- Desktop Nav -->
        <div class="hidden lg:flex items-center gap-1">

          <!-- Writing dropdown -->
          <div class="relative" data-mega="writing">
            <button class="mega-trigger nav-link px-4 py-2 text-sm text-zinc-400 hover:text-zinc-200 transition-colors flex items-center gap-1 font-body font-500">
              Writing
              <svg class="w-3 h-3 opacity-50 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
          </div>

          <!-- Services dropdown -->
          <div class="relative" data-mega="services">
            <button class="mega-trigger nav-link px-4 py-2 text-sm text-zinc-400 hover:text-zinc-200 transition-colors flex items-center gap-1 font-body font-500">
              Services
              <svg class="w-3 h-3 opacity-50 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
          </div>

          <!-- Case Studies (direct link) -->
          <a href="/case-studies.html" class="nav-link px-4 py-2 text-sm text-zinc-400 hover:text-zinc-200 transition-colors font-body font-500">Case Studies</a>

          <!-- About (direct link) -->
          <a href="/about.html" class="nav-link px-4 py-2 text-sm text-zinc-400 hover:text-zinc-200 transition-colors font-body font-500">About</a>

          <div class="w-px h-4 bg-zinc-800 mx-2"></div>

          <!-- CTA -->
          <a href="/services.html#contact" class="px-5 py-2 text-sm font-semibold bg-amber-600 hover:bg-amber-500 text-white rounded-md transition-colors cta-glow font-display">Work With Me</a>
        </div>

        <!-- Mobile menu button -->
        <button id="mobile-menu-btn" aria-label="Open menu" class="lg:hidden p-2 text-zinc-400 hover:text-zinc-200">
          <svg id="menu-icon" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
          <svg id="close-icon" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
      </div>

      <!-- MEGA PANEL: Writing -->
      <div id="mega-writing" class="mega-panel hidden border-t border-zinc-800/60 bg-[#0a0a0a]">
        <div class="max-w-6xl mx-auto px-6 py-8">
          <div class="grid grid-cols-4 gap-8">
            <div>
              <div class="flex items-center gap-2 mb-4">
                <span class="text-xs font-semibold tracking-wider text-zinc-500 uppercase">SEO Strategy</span>
              </div>
              <div class="space-y-1">
                <a href="/articles/why-fractional-seo-beats-agencies.html" class="mega-link">Fractional vs Agencies</a>
                <a href="/articles/why-your-seo-audit-failed.html" class="mega-link">Why SEO Audits Fail</a>
                <a href="/articles/enterprise-seo-audit-4-hour-framework.html" class="mega-link">4-Hour Enterprise Audit</a>
                <a href="/articles/saas-seo-url-architecture-subdomains-subdirectories.html" class="mega-link">SaaS URL Architecture</a>
              </div>
            </div>
            <div>
              <div class="flex items-center gap-2 mb-4">
                <span class="text-xs font-semibold tracking-wider text-zinc-500 uppercase">AI Systems</span>
              </div>
              <div class="space-y-1">
                <a href="/articles/ai-prompt-engineering-seo.html" class="mega-link">AI Prompt Engineering for SEO</a>
                <a href="/articles/local-llm-deployment-enterprise-marketing.html" class="mega-link">Local LLM Deployment</a>
                <a href="/articles/observer-protocol-ai-content-voice-homogenization.html" class="mega-link">Observer Protocol</a>
              </div>
            </div>
            <div>
              <div class="flex items-center gap-2 mb-4">
                <span class="text-xs font-semibold tracking-wider text-zinc-500 uppercase">Business Growth</span>
              </div>
              <div class="space-y-1">
                <a href="/articles/real-estate-seo-systems-database-driven-leads.html" class="mega-link">Database-Driven SEO</a>
                <a href="/articles/google-business-profile-multi-location-local-seo.html" class="mega-link">Multi-Location Local SEO</a>
                <a href="/articles/platform-seo-user-generated-content-scale.html" class="mega-link">Platform SEO at Scale</a>
              </div>
            </div>
            <div>
              <a href="/articles.html" class="mega-view-all">All articles &rarr;</a>
            </div>
          </div>
        </div>
      </div>

      <!-- MEGA PANEL: Services -->
      <div id="mega-services" class="mega-panel hidden border-t border-zinc-800/60 bg-[#0a0a0a]">
        <div class="max-w-6xl mx-auto px-6 py-8">
          <div class="grid grid-cols-4 gap-8">
            <div>
              <a href="/services.html#fractional" class="block group">
                <p class="text-sm font-semibold text-zinc-200 group-hover:text-amber-400 transition-colors">Fractional SEO Leadership</p>
                <p class="text-xs text-zinc-500 mt-1">$8,000/mo &middot; 10 hrs/mo</p>
                <p class="text-xs text-zinc-600 mt-2">Senior strategic oversight embedded in your team. 6-month minimum.</p>
              </a>
            </div>
            <div>
              <a href="/services.html#knowledge" class="block group">
                <p class="text-sm font-semibold text-zinc-200 group-hover:text-amber-400 transition-colors">AI Knowledge Systems</p>
                <p class="text-xs text-zinc-500 mt-1">$5,000 one-time</p>
                <p class="text-xs text-zinc-600 mt-2">Custom AI memory architecture for your team's workflows.</p>
              </a>
            </div>
            <div>
              <a href="/services.html#sites" class="block group">
                <p class="text-sm font-semibold text-zinc-200 group-hover:text-amber-400 transition-colors">Site Builds</p>
                <p class="text-xs text-zinc-500 mt-1">From $5,000</p>
                <p class="text-xs text-zinc-600 mt-2">SEO-native static sites engineered for topical authority.</p>
              </a>
            </div>
            <div>
              <a href="/services.html#consulting" class="block group">
                <p class="text-sm font-semibold text-zinc-200 group-hover:text-amber-400 transition-colors">Consulting</p>
                <p class="text-xs text-zinc-500 mt-1">$200/hr</p>
                <p class="text-xs text-zinc-600 mt-2">Strategy sessions, audits, second opinions. No commitment.</p>
              </a>
            </div>
          </div>
          <div class="mt-6 pt-4 border-t border-zinc-800/40">
            <a href="/services.html" class="text-sm text-amber-500 hover:text-amber-400 font-medium transition-colors">View all services &rarr;</a>
          </div>
        </div>
      </div>

      <!-- Mobile Menu -->
      <div id="mobile-menu" class="hidden lg:hidden border-t border-zinc-800 bg-[#0a0a0a] max-h-[80vh] overflow-y-auto">
        <div class="px-6 py-4 space-y-1">
          <button class="mobile-section-toggle w-full flex items-center justify-between py-3 text-zinc-200 font-medium">
            Writing
            <svg class="w-4 h-4 text-zinc-600 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
          </button>
          <div class="mobile-section hidden pl-4 pb-3 space-y-1">
            <a href="/articles/why-fractional-seo-beats-agencies.html" class="block py-1.5 text-sm text-zinc-400 hover:text-white">Fractional vs Agencies</a>
            <a href="/articles/enterprise-seo-audit-4-hour-framework.html" class="block py-1.5 text-sm text-zinc-400 hover:text-white">4-Hour Enterprise Audit</a>
            <a href="/articles/ai-prompt-engineering-seo.html" class="block py-1.5 text-sm text-zinc-400 hover:text-white">AI Prompt Engineering for SEO</a>
            <a href="/articles.html" class="block py-1.5 text-sm text-amber-500 font-medium">All articles &rarr;</a>
          </div>

          <button class="mobile-section-toggle w-full flex items-center justify-between py-3 text-zinc-200 font-medium">
            Services
            <svg class="w-4 h-4 text-zinc-600 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
          </button>
          <div class="mobile-section hidden pl-4 pb-3 space-y-1">
            <a href="/services.html#fractional" class="block py-1.5 text-sm text-zinc-400 hover:text-white">Fractional SEO &middot; $8K/mo</a>
            <a href="/services.html#knowledge" class="block py-1.5 text-sm text-zinc-400 hover:text-white">AI Knowledge Systems &middot; $5K</a>
            <a href="/services.html#sites" class="block py-1.5 text-sm text-zinc-400 hover:text-white">Site Builds &middot; $5K+</a>
            <a href="/services.html#consulting" class="block py-1.5 text-sm text-zinc-400 hover:text-white">Consulting &middot; $200/hr</a>
            <a href="/services.html" class="block py-1.5 text-sm text-amber-500 font-medium">All services &rarr;</a>
          </div>

          <a href="/case-studies.html" class="block py-3 text-zinc-200 font-medium">Case Studies</a>
          <a href="/about.html" class="block py-3 text-zinc-200 font-medium">About</a>

          <a href="/services.html#contact" class="block mt-4 py-3 bg-amber-600 text-white text-center font-semibold rounded-lg">Work With Me</a>
        </div>
      </div>
    </div>
  </nav>

    <!-- Spacer for fixed nav -->
    <div class="h-16"></div>

    <!-- Breadcrumbs -->
    <div class="max-w-3xl mx-auto px-6 pt-8 pb-4">
      <nav class="text-xs text-zinc-600">
        <a href="/" class="hover:text-zinc-400 transition-colors">Home</a>
        <span class="mx-2">/</span>
        <a href="/articles.html" class="hover:text-zinc-400 transition-colors">Writing</a>
        <span class="mx-2">/</span>
        <span class="text-zinc-500">RAG Architecture for Business Knowledge: Build AI That Knows Your Company</span>
      </nav>
    </div>

    <!-- Article -->
    <main class="max-w-3xl mx-auto px-6 pb-20">
        <article class="prose-dark">
            <h1 class="text-3xl md:text-4xl font-display font-700 text-[#fafafa] leading-tight mb-8">RAG Architecture for Business Knowledge: Build AI That Knows Your Company</h1>
            <div class="flex items-center gap-4 mb-12 text-sm text-zinc-600">
              <span>Victor Valentine Romo</span>
              <span class="text-zinc-800">&middot;</span>
              <time datetime="2026-02-08">2026-02-08</time>
            </div>
            <div class="space-y-6 leading-relaxed text-base">
            <h1>RAG Architecture for Business Knowledge: Build AI That Knows Your Company</h1>
<p>Retrieval-Augmented Generation (RAG) connects AI models to your internal knowledge base—documents, SOPs, emails, CRM data—so they answer questions using your proprietary information, not generic training data. Standard AI tools like <strong>ChatGPT</strong> or <strong>Claude</strong> can&#39;t access your internal systems. RAG fixes this by retrieving relevant context from your knowledge base before generating answers. This transforms AI from generic assistant to company-specific intelligence layer.</p>
<h2>Why Generic AI Models Can&#39;t Answer Company-Specific Questions</h2>
<p>Public AI models train on internet data—Wikipedia, articles, books, code repositories. They don&#39;t know your company&#39;s processes, client history, pricing strategies, or internal decisions. Ask <strong>ChatGPT</strong> &quot;What&#39;s our client onboarding SOP?&quot; and it hallucinates an answer or says &quot;I don&#39;t know.&quot;</p>
<p>RAG solves this by implementing retrieval step before generation. When you ask &quot;What&#39;s our client onboarding SOP?&quot; the system:</p>
<ol>
<li><strong>Retrieves</strong> relevant documents from your knowledge base (client onboarding SOP, related templates, past examples).</li>
<li><strong>Augments</strong> the AI prompt with retrieved context.</li>
<li><strong>Generates</strong> an answer grounded in your actual documentation.</li>
</ol>
<p>This architecture unlocks AI for internal use cases: instant SOP lookup, onboarding Q&amp;A bots, client history summaries, pricing guidance, troubleshooting documentation, and research assistance. Instead of searching through <strong>Notion</strong>, <strong>Google Drive</strong>, or <strong>Confluence</strong> manually, you ask natural language questions and get instant, sourced answers.</p>
<p>RAG also prevents hallucinations. Without context, AI models fill gaps with plausible-sounding fiction. With RAG, answers cite sources: &quot;According to the client onboarding SOP (last updated 2026-01-15), step 3 is...&quot;</p>
<p>Finally, RAG enables continuous learning. As your knowledge base grows—new SOPs, updated processes, recent projects—RAG systems automatically incorporate them. No retraining needed. Update a doc, and future queries reflect that update.</p>
<h2>RAG System Components: Vector Databases, Embeddings, and LLMs</h2>
<p>RAG systems have three core components: document storage (vector database), semantic search (embeddings), and answer generation (LLM).</p>
<p><strong>Component 1: Vector Database</strong>
Stores documents as embeddings (numerical representations of text). When you ask a question, the system searches embeddings for semantically similar documents, not just keyword matches.</p>
<p>Popular vector databases:</p>
<ul>
<li><strong>Pinecone:</strong> Managed service, easy setup, scales automatically. $70-$140/month for SMB use cases.</li>
<li><strong>Weaviate:</strong> Open-source, self-hosted or cloud. Free self-hosted, $25+/month cloud.</li>
<li><strong>Chroma:</strong> Lightweight, embeds into Python apps. Free, open-source.</li>
<li><strong>Qdrant:</strong> Fast, supports filtering metadata. Free self-hosted, $25+/month cloud.</li>
</ul>
<p>Start with <strong>Chroma</strong> or <strong>Pinecone</strong>. Chroma for prototypes or small teams (&lt;5 users). Pinecone for production or teams &gt;10 users.</p>
<p><strong>Component 2: Embedding Model</strong>
Converts text into vectors (arrays of numbers) that capture semantic meaning. &quot;Client onboarding process&quot; and &quot;How to onboard new clients&quot; have similar embeddings even though they use different words.</p>
<p>Popular embedding models:</p>
<ul>
<li><strong>OpenAI text-embedding-3-small:</strong> $0.02 per 1M tokens. Fast, high quality.</li>
<li><strong>Cohere Embed:</strong> $0.10 per 1M tokens. Supports multi-language better.</li>
<li><strong>Open-source models (sentence-transformers):</strong> Free but require self-hosting (compute costs).</li>
</ul>
<p>Start with <strong>OpenAI text-embedding-3-small</strong>. Cheap, reliable, easy integration.</p>
<p><strong>Component 3: LLM for Generation</strong>
Generates answers using retrieved context. Supports <strong>GPT-4</strong>, <strong>Claude Opus</strong>, or <strong>Gemini</strong>.</p>
<ul>
<li><strong>GPT-4:</strong> $10-$30 per 1M tokens (varies by model). Strong general capabilities.</li>
<li><strong>Claude Opus 4.6:</strong> $15-$75 per 1M tokens. Better for long-context and reasoning.</li>
<li><strong>Claude Sonnet:</strong> $3-$15 per 1M tokens. Cheaper, faster, good for most queries.</li>
</ul>
<p>Start with <strong>Claude Sonnet</strong> for cost efficiency. Upgrade to <strong>Opus</strong> if queries need deep reasoning or long-context handling.</p>
<p><strong>System flow:</strong></p>
<ol>
<li>User asks: &quot;What&#39;s our pricing for SEO retainers?&quot;</li>
<li>Embedding model converts question to vector.</li>
<li>Vector database searches for documents with similar embeddings (pricing docs, proposal templates).</li>
<li>Top 3-5 most relevant documents retrieved.</li>
<li>LLM receives prompt: &quot;Answer this question using only the following context: [retrieved docs]. Question: What&#39;s our pricing for SEO retainers?&quot;</li>
<li>LLM generates answer citing sources.</li>
</ol>
<h2>Building a Minimal Viable RAG System in 4 Hours</h2>
<p>You don&#39;t need ML expertise to build basic RAG. Use <strong>LangChain</strong> or <strong>LlamaIndex</strong> (Python libraries) to assemble components quickly.</p>
<p><strong>Tech stack:</strong></p>
<ul>
<li><strong>Python 3.10+</strong></li>
<li><strong>LangChain</strong> or <strong>LlamaIndex</strong> (orchestration frameworks)</li>
<li><strong>Chroma</strong> or <strong>Pinecone</strong> (vector database)</li>
<li><strong>OpenAI API</strong> (embeddings + LLM)</li>
</ul>
<p><strong>Step 1: Collect documents</strong>
Gather internal docs you want RAG to access: SOPs, templates, meeting notes, client files, product docs. Export as markdown, PDF, or text files. Store in one folder: <code>/knowledge_base/</code>.</p>
<p><strong>Step 2: Install dependencies</strong></p>
<pre><code class="language-bash">pip install langchain chromadb openai python-dotenv
</code></pre>
<p><strong>Step 3: Set up API keys</strong>
Create <code>.env</code> file:</p>
<pre><code>OPENAI_API_KEY=your_openai_key_here
</code></pre>
<p><strong>Step 4: Ingest documents</strong>
Load documents, split into chunks, generate embeddings, store in Chroma:</p>
<pre><code class="language-python">from langchain.document_loaders import DirectoryLoader
from langchain.text_splitter import RecursiveCharacterTextSplitter
from langchain.embeddings import OpenAIEmbeddings
from langchain.vectorstores import Chroma
import os
from dotenv import load_dotenv

load_dotenv()

# Load documents
loader = DirectoryLoader(&#39;./knowledge_base/&#39;, glob=&quot;**/*.md&quot;)
documents = loader.load()

# Split into chunks (1000 chars, 200 overlap)
text_splitter = RecursiveCharacterTextSplitter(chunk_size=1000, chunk_overlap=200)
chunks = text_splitter.split_documents(documents)

# Generate embeddings and store
embeddings = OpenAIEmbeddings()
vectorstore = Chroma.from_documents(chunks, embeddings, persist_directory=&quot;./chroma_db&quot;)
print(f&quot;Ingested {len(chunks)} chunks from {len(documents)} documents&quot;)
</code></pre>
<p>Run this script once to populate vector database. As you add/update docs, re-run to refresh.</p>
<p><strong>Step 5: Query the system</strong>
Retrieve relevant chunks and generate answer:</p>
<pre><code class="language-python">from langchain.chains import RetrievalQA
from langchain.llms import OpenAI

# Load vectorstore
vectorstore = Chroma(persist_directory=&quot;./chroma_db&quot;, embedding_function=OpenAIEmbeddings())

# Create retrieval chain
qa_chain = RetrievalQA.from_chain_type(
    llm=OpenAI(model=&quot;gpt-3.5-turbo&quot;),
    chain_type=&quot;stuff&quot;,
    retriever=vectorstore.as_retriever(search_kwargs={&quot;k&quot;: 3})
)

# Ask question
question = &quot;What&#39;s our client onboarding process?&quot;
answer = qa_chain.run(question)
print(answer)
</code></pre>
<p><strong>Step 6: Add source citations</strong>
Modify to return sources:</p>
<pre><code class="language-python">qa_chain = RetrievalQA.from_chain_type(
    llm=OpenAI(model=&quot;gpt-3.5-turbo&quot;),
    chain_type=&quot;stuff&quot;,
    retriever=vectorstore.as_retriever(search_kwargs={&quot;k&quot;: 3}),
    return_source_documents=True
)

result = qa_chain({&quot;query&quot;: question})
print(&quot;Answer:&quot;, result[&#39;result&#39;])
print(&quot;\nSources:&quot;)
for doc in result[&#39;source_documents&#39;]:
    print(f&quot;- {doc.metadata[&#39;source&#39;]}&quot;)
</code></pre>
<p>This builds a functional RAG system in 2-4 hours depending on familiarity with Python.</p>
<h2>Optimizing Retrieval Quality with Chunking and Metadata</h2>
<p>Poor retrieval ruins RAG systems. If irrelevant documents get retrieved, LLM generates bad answers. Optimize retrieval through chunking strategy and metadata filtering.</p>
<p><strong>Chunking strategy:</strong>
Documents split into chunks before embedding. Chunk size affects retrieval quality.</p>
<ul>
<li><strong>Too small (100-200 chars):</strong> Chunks lack context. &quot;Our pricing is $5K&quot; without explaining what $5K refers to.</li>
<li><strong>Too large (5,000+ chars):</strong> Chunks contain too much unrelated information. Dilutes semantic meaning.</li>
<li><strong>Sweet spot: 800-1,200 chars</strong> with 200-char overlap. Overlap ensures concepts spanning chunk boundaries aren&#39;t lost.</li>
</ul>
<p>Test chunk sizes. Run queries against different configurations, evaluate answer quality.</p>
<p><strong>Metadata enrichment:</strong>
Add metadata to chunks (document type, date, author, category). This enables filtering during retrieval.</p>
<p>Example metadata:</p>
<pre><code class="language-python">documents = [
    Document(page_content=&quot;Client onboarding steps...&quot;, metadata={&quot;type&quot;: &quot;SOP&quot;, &quot;category&quot;: &quot;sales&quot;, &quot;date&quot;: &quot;2026-01-15&quot;}),
    Document(page_content=&quot;Pricing for retainers...&quot;, metadata={&quot;type&quot;: &quot;pricing&quot;, &quot;category&quot;: &quot;sales&quot;, &quot;date&quot;: &quot;2025-12-10&quot;})
]
</code></pre>
<p>Filter retrieval by metadata:</p>
<pre><code class="language-python">retriever = vectorstore.as_retriever(
    search_kwargs={&quot;k&quot;: 3, &quot;filter&quot;: {&quot;category&quot;: &quot;sales&quot;}}
)
</code></pre>
<p>This retrieves only sales-related docs, improving relevance for sales queries.</p>
<p><strong>Hybrid search (semantic + keyword):</strong>
Pure semantic search sometimes misses exact terms. Combine semantic search (embeddings) with keyword search (BM25):</p>
<pre><code class="language-python">from langchain.retrievers import BM25Retriever, EnsembleRetriever

# Semantic retriever
semantic_retriever = vectorstore.as_retriever(search_kwargs={&quot;k&quot;: 5})

# Keyword retriever
keyword_retriever = BM25Retriever.from_documents(documents)
keyword_retriever.k = 5

# Ensemble (combines both)
ensemble_retriever = EnsembleRetriever(retrievers=[semantic_retriever, keyword_retriever], weights=[0.5, 0.5])
</code></pre>
<p>This catches both semantically similar and keyword-exact matches.</p>
<p><strong>Re-ranking retrieved documents:</strong>
After initial retrieval, re-rank results using a more sophisticated model (<strong>Cohere Rerank</strong>, <strong>cross-encoders</strong>). Re-ranking improves top-3 relevance by 20-30%.</p>
<pre><code class="language-python">from langchain.retrievers import ContextualCompressionRetriever
from langchain.retrievers.document_compressors import CohereRerank

# Base retriever
base_retriever = vectorstore.as_retriever(search_kwargs={&quot;k&quot;: 10})

# Rerank top 10 down to top 3
compressor = CohereRerank(model=&quot;rerank-english-v2.0&quot;, top_n=3)
compression_retriever = ContextualCompressionRetriever(
    base_compressor=compressor,
    base_retriever=base_retriever
)
</code></pre>
<p>This retrieves 10 candidates, re-ranks, returns top 3. Cost: ~$1-$2 per 1K queries.</p>
<h2>Adding Chat Memory for Multi-Turn Conversations</h2>
<p>Basic RAG answers one question at a time. Chat memory enables follow-up questions: &quot;What&#39;s our pricing?&quot; → &quot;How does that compare to competitors?&quot; without repeating context.</p>
<p><strong>LangChain conversation memory:</strong></p>
<pre><code class="language-python">from langchain.memory import ConversationBufferMemory
from langchain.chains import ConversationalRetrievalChain

memory = ConversationBufferMemory(memory_key=&quot;chat_history&quot;, return_messages=True)

qa_chain = ConversationalRetrievalChain.from_llm(
    llm=OpenAI(model=&quot;gpt-3.5-turbo&quot;),
    retriever=vectorstore.as_retriever(),
    memory=memory
)

# First question
response = qa_chain({&quot;question&quot;: &quot;What&#39;s our client onboarding process?&quot;})
print(response[&#39;answer&#39;])

# Follow-up (memory retains context)
response = qa_chain({&quot;question&quot;: &quot;How long does that typically take?&quot;})
print(response[&#39;answer&#39;])
</code></pre>
<p>Memory persists conversation history. LLM uses prior context to interpret follow-ups.</p>
<p>For production, persist memory per user session (store in <strong>Redis</strong>, <strong>PostgreSQL</strong>, or session cookies). This enables multi-session continuity—users can return days later and resume conversations.</p>
<h2>Deploying RAG Systems: Chatbots, Slack Bots, and APIs</h2>
<p>RAG systems need interfaces. Deploy as web chatbots, Slack bots, or APIs.</p>
<p><strong>Web chatbot (Streamlit):</strong>
Build UI in Python using <strong>Streamlit</strong>:</p>
<pre><code class="language-python">import streamlit as st
from langchain.chains import RetrievalQA
from langchain.vectorstores import Chroma
from langchain.embeddings import OpenAIEmbeddings
from langchain.llms import OpenAI

st.title(&quot;Company Knowledge Base&quot;)

vectorstore = Chroma(persist_directory=&quot;./chroma_db&quot;, embedding_function=OpenAIEmbeddings())
qa_chain = RetrievalQA.from_chain_type(
    llm=OpenAI(model=&quot;gpt-3.5-turbo&quot;),
    retriever=vectorstore.as_retriever(),
    return_source_documents=True
)

question = st.text_input(&quot;Ask a question:&quot;)
if st.button(&quot;Submit&quot;):
    result = qa_chain({&quot;query&quot;: question})
    st.write(&quot;**Answer:**&quot;, result[&#39;result&#39;])
    st.write(&quot;**Sources:**&quot;)
    for doc in result[&#39;source_documents&#39;]:
        st.write(f&quot;- {doc.metadata[&#39;source&#39;]}&quot;)
</code></pre>
<p>Run: <code>streamlit run app.py</code>. Access at <code>localhost:8501</code>.</p>
<p>Deploy to cloud (<strong>Streamlit Cloud</strong> free, <strong>Render</strong> $7/month, <strong>Fly.io</strong> $5-$10/month).</p>
<p><strong>Slack bot:</strong>
Integrate RAG into Slack using <strong>Slack Bolt</strong> (Python SDK):</p>
<pre><code class="language-python">from slack_bolt import App
from langchain.chains import RetrievalQA
# ... (same setup as above)

app = App(token=os.environ[&quot;SLACK_BOT_TOKEN&quot;])

@app.message(&quot;.*&quot;)
def handle_message(message, say):
    question = message[&#39;text&#39;]
    result = qa_chain({&quot;query&quot;: question})
    say(result[&#39;result&#39;])

if __name__ == &quot;__main__&quot;:
    app.start(port=3000)
</code></pre>
<p>Deploy to <strong>Heroku</strong>, <strong>Render</strong>, or <strong>Fly.io</strong>. Users ask questions in Slack, bot responds with RAG answers.</p>
<p><strong>REST API (FastAPI):</strong>
Expose RAG as API for custom integrations:</p>
<pre><code class="language-python">from fastapi import FastAPI
from pydantic import BaseModel
# ... (same setup)

app = FastAPI()

class Query(BaseModel):
    question: str

@app.post(&quot;/ask&quot;)
def ask(query: Query):
    result = qa_chain({&quot;query&quot;: query.question})
    return {
        &quot;answer&quot;: result[&#39;result&#39;],
        &quot;sources&quot;: [doc.metadata[&#39;source&#39;] for doc in result[&#39;source_documents&#39;]]
    }
</code></pre>
<p>Run: <code>uvicorn api:app --reload</code>. Access at <code>localhost:8000/ask</code>.</p>
<h2>Security, Access Control, and Compliance</h2>
<p>RAG systems access internal data. Secure them properly.</p>
<p><strong>Access control:</strong></p>
<ul>
<li>Implement user authentication (OAuth, SSO).</li>
<li>Role-based access: Sales sees sales docs, Ops sees ops docs. Filter retrieval by user role metadata.</li>
<li>Log queries: Track who asked what, when. Audit for misuse.</li>
</ul>
<p><strong>Data privacy:</strong></p>
<ul>
<li>Use zero data retention AI models (<strong>Claude for Enterprise</strong>, <strong>OpenAI Enterprise</strong>) to prevent training on your data.</li>
<li>For sensitive docs, self-host LLMs (use <strong>Llama 3</strong>, <strong>Mistral</strong> via <strong>Ollama</strong>) to keep data on-premises.</li>
<li>Encrypt vector databases and data at rest.</li>
</ul>
<p><strong>Compliance (GDPR, HIPAA, SOC 2):</strong></p>
<ul>
<li>Redact PII before ingesting docs into RAG.</li>
<li>Implement data deletion workflows: when docs are deleted from source, remove from vector DB.</li>
<li>For regulated industries, consult legal before deploying RAG on sensitive data.</li>
</ul>
<h2>RAG Use Cases for B2B Operations</h2>
<p><strong>Use case 1: Internal knowledge Q&amp;A</strong>
Employees ask questions about company policies, SOPs, benefits, IT troubleshooting. RAG replaces searching through <strong>Confluence</strong>, <strong>Notion</strong>, or asking coworkers.</p>
<p><strong>Use case 2: Client history summaries</strong>
Sales or support staff ask &quot;Summarize interactions with Client X in the past 6 months.&quot; RAG retrieves CRM notes, emails, support tickets, generates summary.</p>
<p><strong>Use case 3: Onboarding assistant</strong>
New hires ask questions about onboarding: &quot;Where do I submit expenses?&quot; &quot;Who&#39;s my manager?&quot; RAG answers using onboarding docs and org charts.</p>
<p><strong>Use case 4: Proposal and contract generation</strong>
Sales team asks &quot;Draft a proposal for [Client Y] including [services].&quot; RAG retrieves similar proposals, templates, pricing docs, generates customized draft.</p>
<p><strong>Use case 5: Research and competitive intel</strong>
Analysts ask &quot;What&#39;s our competitive positioning vs. Competitor Z?&quot; RAG retrieves internal strategy docs, market research, past analyses.</p>
<p><strong>Use case 6: Troubleshooting and support</strong>
Technical support asks &quot;How do we fix [error X]?&quot; RAG retrieves troubleshooting guides, past ticket resolutions, engineering docs.</p>
<p><strong>Use case 7: Compliance and legal queries</strong>
Legal or compliance teams ask &quot;What&#39;s our data retention policy?&quot; RAG retrieves policies, regulatory docs, past decisions.</p>
<h2>FAQ: RAG Architecture for Business Knowledge</h2>
<h3>How much does it cost to run a RAG system?</h3>
<p><strong>Setup:</strong> $0-$500 (developer time, no external costs if using open-source tools).
<strong>Monthly operating:</strong> $50-$300 depending on usage. <strong>Pinecone</strong> ($70-$140/month), <strong>OpenAI API</strong> ($10-$100/month for embeddings + LLM), hosting ($10-$50/month). Total: $90-$290/month for small-medium teams (&lt;50 users).</p>
<h3>How do I keep the knowledge base updated?</h3>
<p>Re-run ingestion script whenever docs change. Automate with cron jobs (nightly) or webhooks (trigger ingestion when docs are updated in <strong>Notion</strong>, <strong>Google Drive</strong>, etc.). Use <strong>Zapier</strong> or <strong>n8n</strong> to connect doc platforms to ingestion pipeline.</p>
<h3>Can RAG work with non-text data (PDFs, images, videos)?</h3>
<p>Yes, with additional preprocessing. <strong>PDFs:</strong> Extract text using <strong>PyPDF2</strong> or <strong>pdfplumber</strong> before ingesting. <strong>Images:</strong> Use OCR (<strong>Tesseract</strong>) or vision models (<strong>GPT-4 Vision</strong>) to extract text. <strong>Videos:</strong> Transcribe audio using <strong>Whisper</strong> (OpenAI), ingest transcripts.</p>
<h3>What if the AI hallucinates despite having retrieval?</h3>
<p>Hallucinations occur when: (1) retrieval fails (no relevant docs found), (2) LLM ignores context, (3) context is ambiguous. Fixes: Improve retrieval quality (better chunking, metadata), constrain LLM (&quot;Only answer using provided context. If context doesn&#39;t answer the question, say &#39;I don&#39;t know.&#39;&quot;), use citations to verify answers.</p>
<h3>Can I build RAG without coding?</h3>
<p>Limited options. <strong>Glean</strong>, <strong>Dashworks</strong>, and <strong>Hebbia</strong> offer no-code RAG for enterprise knowledge bases. Cost: $5K-$50K/year. For small teams, basic coding (Python + LangChain) is more cost-effective and flexible.</p>
<p>Related: <a href="personal-knowledge-management-operators.html">personal-knowledge-management-operators.html</a>, <a href="prompt-libraries-b2b-teams.html">prompt-libraries-b2b-teams.html</a>, <a href="operator-tech-stack-tools.html">operator-tech-stack-tools.html</a></p>

            </div>
        </article>

        <!-- Back link -->
        <div class="mt-16 pt-8 border-t border-zinc-800/60">
            <a href="/articles.html" class="text-amber-500 hover:text-amber-400 font-medium transition-colors">&larr; All articles</a>
        </div>

        <!-- CTA -->
        <div class="mt-12 bg-[#171717] border border-zinc-800 rounded-xl p-8">
          <h3 class="text-xl font-display font-600 text-[#fafafa] mb-3">Need this implemented?</h3>
          <p class="text-zinc-400 text-sm mb-6 max-w-lg">I build the search infrastructure behind mid-market B2B growth. If you want these systems running inside your company, not just on your reading list.</p>
          <a href="/services.html#contact" class="inline-block px-6 py-3 bg-amber-600 hover:bg-amber-500 text-white font-semibold rounded-lg transition-colors text-sm">Work With Me</a>
        </div>
    </main>


  <footer class="border-t border-zinc-800/60 bg-[#0a0a0a] pt-16 pb-8">
    <div class="max-w-6xl mx-auto px-6">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-10 mb-14">

        <!-- Col 1: About Victor -->
        <div class="col-span-2 md:col-span-1">
          <div class="flex items-center gap-2 mb-4">
            <span class="font-display font-700 text-lg text-amber-500">b2bvic</span>
          </div>
          <p class="text-sm text-zinc-500 leading-relaxed mb-4">Victor Valentine Romo. Fractional SEO leadership and AI knowledge systems for mid-market B2B companies.</p>
          <a href="/services.html#contact" class="inline-block px-4 py-2 text-sm font-semibold bg-amber-600 hover:bg-amber-500 text-white rounded-md transition-colors">Work With Me</a>
        </div>

        <!-- Col 2: Popular Articles -->
        <div>
          <p class="text-xs text-zinc-600 uppercase tracking-wider mb-4 font-semibold">Writing</p>
          <ul class="space-y-2 text-sm">
            <li><a href="/articles/why-fractional-seo-beats-agencies.html" class="text-zinc-400 hover:text-white transition-colors">Fractional vs Agencies</a></li>
            <li><a href="/articles/why-your-seo-audit-failed.html" class="text-zinc-400 hover:text-white transition-colors">Why SEO Audits Fail</a></li>
            <li><a href="/articles/enterprise-seo-audit-4-hour-framework.html" class="text-zinc-400 hover:text-white transition-colors">4-Hour Audit Framework</a></li>
            <li><a href="/articles/ai-prompt-engineering-seo.html" class="text-zinc-400 hover:text-white transition-colors">AI Prompts for SEO</a></li>
            <li><a href="/articles/local-llm-deployment-enterprise-marketing.html" class="text-zinc-400 hover:text-white transition-colors">Local LLM Deployment</a></li>
            <li><a href="/articles/observer-protocol-ai-content-voice-homogenization.html" class="text-zinc-400 hover:text-white transition-colors">Observer Protocol</a></li>
            <li><a href="/articles/saas-seo-url-architecture-subdomains-subdirectories.html" class="text-zinc-400 hover:text-white transition-colors">SaaS URL Architecture</a></li>
            <li><a href="/articles.html" class="text-amber-500 hover:text-amber-400 transition-colors font-medium">All articles &rarr;</a></li>
          </ul>
        </div>

        <!-- Col 3: Services -->
        <div>
          <p class="text-xs text-zinc-600 uppercase tracking-wider mb-4 font-semibold">Services</p>
          <ul class="space-y-2 text-sm">
            <li><a href="/services.html#fractional" class="text-zinc-400 hover:text-white transition-colors">Fractional SEO ($8K/mo)</a></li>
            <li><a href="/services.html#knowledge" class="text-zinc-400 hover:text-white transition-colors">AI Knowledge Systems ($5K)</a></li>
            <li><a href="/services.html#sites" class="text-zinc-400 hover:text-white transition-colors">Site Builds ($5K+)</a></li>
            <li><a href="/services.html#consulting" class="text-zinc-400 hover:text-white transition-colors">Consulting ($200/hr)</a></li>
            <li><a href="/about.html" class="text-zinc-400 hover:text-white transition-colors">About</a></li>
            <li><a href="/case-studies.html" class="text-zinc-400 hover:text-white transition-colors">Case Studies</a></li>
          </ul>
        </div>

        <!-- Col 4: Network -->
        <div>
          <p class="text-xs text-zinc-600 uppercase tracking-wider mb-4 font-semibold">Network</p>
          <ul class="space-y-2 text-sm">
            <li><a href="https://scalewithsearch.com" target="_blank" rel="me" class="text-zinc-400 hover:text-white transition-colors">Scale With Search</a></li>
            <li><a href="https://aifirstsearch.com" target="_blank" rel="me" class="text-zinc-400 hover:text-white transition-colors">AI First Search</a></li>
            <li><a href="https://browserprompt.com" target="_blank" rel="me" class="text-zinc-400 hover:text-white transition-colors">Browser Prompt</a></li>
            <li><a href="https://polytraffic.com" target="_blank" rel="me" class="text-zinc-400 hover:text-white transition-colors">Polytraffic</a></li>
            <li><a href="https://victorvalentineromo.com" target="_blank" rel="me" class="text-zinc-400 hover:text-white transition-colors">Victor Valentine Romo</a></li>
            <li><a href="https://seobyrole.com" target="_blank" rel="me" class="text-zinc-400 hover:text-white transition-colors">SEO By Role</a></li>
          </ul>
        </div>
      </div>

      <!-- Bottom bar -->
      <div class="pt-8 border-t border-zinc-800/60 flex flex-col md:flex-row items-center justify-between gap-4">
        <p class="text-xs text-zinc-700">&copy; 2026 Victor Valentine Romo. All rights reserved.</p>
        <p class="text-xs text-zinc-700">A <a href="https://scalewithsearch.com" target="_blank" class="text-zinc-500 hover:text-amber-500 transition-colors">Scale With Search</a> property.</p>
      </div>
    </div>
  </footer>


  <script>
    // Mega menu
    (function() {
      const triggers = document.querySelectorAll('.mega-trigger');
      const panels = document.querySelectorAll('.mega-panel');
      let closeTimeout = null;

      function openPanel(id) {
        clearTimeout(closeTimeout);
        panels.forEach(p => p.classList.add('hidden'));
        triggers.forEach(t => t.setAttribute('aria-expanded', 'false'));
        const panel = document.getElementById('mega-' + id);
        const trigger = document.querySelector('[data-mega="' + id + '"] .mega-trigger');
        if (panel) panel.classList.remove('hidden');
        if (trigger) trigger.setAttribute('aria-expanded', 'true');
      }

      function scheduleClose() {
        closeTimeout = setTimeout(() => {
          panels.forEach(p => p.classList.add('hidden'));
          triggers.forEach(t => t.setAttribute('aria-expanded', 'false'));
        }, 200);
      }

      function cancelClose() { clearTimeout(closeTimeout); }

      triggers.forEach(btn => {
        const wrapper = btn.closest('[data-mega]');
        const id = wrapper.getAttribute('data-mega');
        btn.addEventListener('mouseenter', () => openPanel(id));
        btn.addEventListener('click', (e) => {
          e.preventDefault();
          const panel = document.getElementById('mega-' + id);
          if (panel && !panel.classList.contains('hidden')) {
            panel.classList.add('hidden');
            btn.setAttribute('aria-expanded', 'false');
          } else {
            openPanel(id);
          }
        });
        wrapper.addEventListener('mouseleave', scheduleClose);
      });

      panels.forEach(panel => {
        panel.addEventListener('mouseenter', cancelClose);
        panel.addEventListener('mouseleave', scheduleClose);
      });

      document.addEventListener('click', (e) => {
        if (!e.target.closest('[data-mega]') && !e.target.closest('.mega-panel')) {
          panels.forEach(p => p.classList.add('hidden'));
          triggers.forEach(t => t.setAttribute('aria-expanded', 'false'));
        }
      });

      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          panels.forEach(p => p.classList.add('hidden'));
          triggers.forEach(t => t.setAttribute('aria-expanded', 'false'));
        }
      });
    })();

    // Mobile menu
    const mobileMenuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    const closeIcon = document.getElementById('close-icon');
    if (mobileMenuBtn) {
      mobileMenuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        menuIcon.classList.toggle('hidden');
        closeIcon.classList.toggle('hidden');
      });
    }

    // Mobile accordion sections
    document.querySelectorAll('.mobile-section-toggle').forEach(btn => {
      btn.addEventListener('click', () => {
        const section = btn.nextElementSibling;
        const chevron = btn.querySelector('svg');
        section.classList.toggle('hidden');
        chevron.style.transform = section.classList.contains('hidden') ? '' : 'rotate(180deg)';
      });
    });

    // Self-link neutralizer
    (function() {
      const currentPath = window.location.pathname.replace(/\.html$/, '').replace(/\/$/, '') || '/';
      document.querySelectorAll('a[href]').forEach(a => {
        const href = a.getAttribute('href').replace(/\.html$/, '').replace(/\/$/, '') || '/';
        if (href === currentPath) {
          a.removeAttribute('href');
          a.setAttribute('aria-current', 'page');
          a.style.opacity = '0.5';
          a.style.pointerEvents = 'none';
        }
      });
    })();
  </script>

</body>
</html>